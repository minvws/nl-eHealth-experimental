<!DOCTYPE html>
<html lang="EN">
<head>
  <link rel="stylesheet" href="styles.css">
  <title>FHIR2QR</title>
  <script src="scripts.js" type="application/javascript"></script>
</head>
<body>
  <div>
    <h1>FHIR 2 QR</h1>
    <div>
      <label for="fhir_server">FHIR Server:</label>
      This queries the given FHIR server for Immunization resources, and will:
      <ol>
      <li>
      Fetch FHIR from <input id=url value="https://hl7eu.onfhir.io/r4/"/>
      by <button onclick="import_url()">importing</button> it.
<br/>
     <form action="/fhir2qr" method="post">
         <textarea name="fhir" id="fhir" rows="20" cols="80"></textarea>
         <script type="application/javascript">fhir_query_res("fhir")</script>
      </li>
        <li>convert the returned JSON to an eHN Vaccination Minimum Data Set as per Annex 1
          <input type="submit" value="show" formaction="fhir2json"/>,
          </li>
        <li>semantically compress it,
        <li>serialize it,
          <input type="submit" value="show" formaction="fhir2jsoncbor"/>,
	</li>
        <li>digitally sign it <input type="submit" value="show" formaction="fhir2jsoncborcose"/> with:
	<ul>
		<li> private key as a <a href="dsc-worker.key">PEM file</a> (<i>which you normally would not get!</i>).  </li>
		<li> and the KeyID of the DSCS certificate <a href="dsc-worker.pem">PEM file</a> (plain concatenation; not a LDIFF).  </li>
		<li> Which is on this Country DSCS list, available as <a href="masterlist-dsc.pem">PEM file</a>.  </li>
		<li> And which is signed by the Country CSCA, availablea <a href="csca.pem">PEM file</a>.  </li>
	</ul>
        </li>
        <li>LZMA compress it,
          <input type="submit" value="show" formaction="fhir2jsoncborcosezlib"/>,
	</li>
        <li><a href="https://tools.ietf.org/html/draft-faltstrom-base45-02">Base45</a> encode it
          <input type="submit" value="show" formaction="fhir2jsoncborcosezlibb45"/>,
	</li>
        <li> and finally generate QR code from it
         <input type="submit" value="show qr" formaction="fhir2jsoncborcosezlibb45qr"/>.
	</li>
      </ol>
      <p>Or 
         <input type="submit" value="show the sizes" formaction="fhir2size"/> after each step.
    </form>
  </div>
</body>
</html>
