# X509 packaging

Running make will output below - a C.L. key contained in an X509 extension. The defintion of this
extension is in ``` x509v3-cl-extension.asn1```.


It takes an Idemix XML file (example in ```cl.xml```). The key output file when doing ```make``` is:

	cl-key.cnf
and
	out/fake-cl.pem

Alternatively run it as:

	./xml2asn1 -p ./cl.xml 

And flags that are  ```-p``` is pretty print, ```-d``` is for DER and most useful is probably ```-c``` is for an openssl CNF file. See ```cl-sign.sh``` for how to use this. The default is ```PEM```. The ```-D``` flag shows how the XML is parsed. 


## Server/Medical-professional certificate

For testing purposes this script will also create a national root certicate,
a server certiciate and a medical professional certificate.


## Structure of the extension

The relevant section of the structure is show below (see the file ```x509v3-cl-extension.asn1``` for
the full definition).

```
sa-ZKP SIGNATURE-ALGORITHM ::= {
   IDENTIFIER id-zkp
   PARAMS TYPE NULL ARE absent
   HASHES { ... }
   PUBLIC-KEYS { pk-ZKP }
  }

pk-ZKP PUBLIC-KEY ::= {
   IDENTIFIER id-zkp
   KEY ZKPPublicKey
   PARAMS TYPE NULL ARE absent
   -- Private key format not in this module --
   CERT-KEY-USAGE {digitalSignature}
  }

ZKPPublicKey ::= SEQUENCE {
   counter INTEGER (0..MAX),
   n INTEGER,
   z INTEGER,
   s INTEGER, 
   bases SEQUENCE OF INTEGER
}
```

The unique OID of this extension is 1.3.6.1.4.1.1847.2021.1.

The only ZKP\_ALG\_OID that is defined is 1.3.6.1.4.1.1847.2021.2.1 for Camenisch-Lysyanskaya.

```
    0:d=0  hl=4 l=4008 cons: SEQUENCE          
    4:d=1  hl=2 l=  12 prim:  OBJECT            :Camenisch-Lysyanskaya
   18:d=1  hl=2 l=   0 cons:  SEQUENCE          
   20:d=1  hl=2 l=  73 cons:  SEQUENCE          
   22:d=2  hl=2 l=  71 cons:   SEQUENCE          
   24:d=3  hl=2 l=  25 prim:    IA5STRING         :http://site.com/proof.txt
   51:d=3  hl=2 l=   8 prim:    OBJECT            :hmacWithSHA256
   61:d=3  hl=2 l=  32 prim:    OCTET STRING      :A Not Very Random SHA256 Digest!
   95:d=1  hl=4 l=3913 cons:  SEQUENCE          
   99:d=2  hl=4 l=3909 cons:   SEQUENCE          
  103:d=3  hl=2 l=   1 prim:    INTEGER           :00
  106:d=3  hl=4 l= 257 prim:    INTEGER           :A4CA7E508CBCE3957C6483E66A7873BD25A62879B9D9A7D524219D9EA3E738A2D26771EF0BEC5C38A480C51658A6D86956D6A4C43C979B21B9AACB7A32F30E4E90956C5CA39ACF6DFA0AFB62EE42FA19DCEE5F5744451C69D7E3921F0B0AB6F4F6D0D81EF7B9E151E474605AF0847B962FB3ABFD72267452A09149BFD7BB542BC0A6859020A39A1E579CA86F79EFA3EC31C57372025318AA60124206302E561FCF57468DA3BA2116B31DFD6736ED2D16378308B71FD273037CB67164C102C15220CE81EC5B01F751DC4783616E11D7BC619C61EA79499DD879B90854B2F000F5426CDB1650EFC8E04EAA66A7FC7ADE9D2FCD3AC35E2C8E253A047B59BC1C6A65
  367:d=3  hl=4 l= 256 prim:    INTEGER           :105DA2DAC9F8FF4442408808A6063F402ADB54097462AE0505E851559053567DAAFC277352CFCF0DB2C50A78FAA68B842B33A3D5BD6ECC7FC217614F6B01ABCA5367AFCDA21FCE323DA6C14E03584AF7328C947F281EAF71EBD11280282DCEE2F694032737EB3DB4E92579D99DFC9BBF5BE81F9FD4C59B02CCC6DA1AC444FE2C0DC4F2C2AECBBCBB78CAAC770A249B246289E57818239611D2BCEC820AD8F93DEEE3AA4A2D5A4C136E449C5E1EF099C3F1E20496E11131F011CA14936F387236536238D5FFE041930238576B3B4E65713DB3743B13F0641BABEA1DD7E39EFD03EC2E14861844FFBBBCE9EFDBFB08CE7B3CD3EF8FF5E13B5188DAA95B57DBD52A
  627:d=3  hl=4 l= 256 prim:    INTEGER           :4D3615E2CD1ABE93FCED2FE50E27AED0800E1CD76AFEEC3844FDA4675FAE3DCCEFC7F5D28D5106205A2EE8659CA3BB3ECCF38FED78DC0515E25464B652939EB8CF95E2F0203FF71D3C72FB7B13805FC0CFA7CDB555C48FC5208D8F64D736FFE999B230FB8D47E5E421E7D53424C395BB87C1997E8A4D513A471A8E4F66407B71BAEDF1CF5BB433B362EB68BC66C3ADD15C4027211D670D7145694710C7D14866972A6FFDB687D1A9DE4E9613CB1B0EFAA0AF2D648F3A64AB3FFCEB7039FE492230AA2B402CDAE0DF8D00513B0B13D546E2B22AC99CF10DF0D20C744ED20E077DA6C9162601041E1946A695227D516CB3547E22FDCD46815FB42FC76EBCFB1760
  887:d=3  hl=4 l=3121 cons:    SEQUENCE          
  891:d=4  hl=4 l= 256 prim:     INTEGER           :6D295E3FBDD061F82315C26C81DC6E34DAB18C0F6317981FF65A3A988F29CBB22C59CE82E0D55D9CAA5F75B7D230E79928C12A88B915BCB010507CE1E5082C6D5D9B20F40E6FD1FC0D5360D088BF4DD18A053DF9308D3F7412C5D4568EB8981F1366B15C8F913FEE6E1FD1812E63B075284C80DFBE86CC4B82E2D3AFE3EB56F1A894A330892E8E4E05AF45364CB74D2CA56BE2BF08D4DCB203DE5E611A9871BD3DD5C5317F64042C104A693E2078B205F33AEE3B77CCC031C52A3EB0B64BB858E01642D707150416AEE42EC4A4AA23AC5E334B43CBF576F31A9E309E9C873950B843FFF5AA4D06CB56CFD5133F079CCEB5479BF5DE0DA1F9FDC5819257FBB941
 1151:d=4  hl=4 l= 256 prim:     INTEGER           :610EF6186B048204DBDF5867C44E2F1C164300570A1D741A9C76FD37ED3C100E8A8085A2B3B67CC11C0B7809271A577F901FEB5ECA27AB31848F9844BBCB260AA69F8C1C30B3D5E773CBF0CB753105A4C9A75BB66CCE7F1427C07B8A97E10BE8C921277E01FA7FCF62ABCC47C88CDB3468C3390329D1FADDCFF665728D55E98CCCB273643990636D9E1E6F5D866FA273FBAA90773CDB9A8D16AF5165192213A488D0B3CC7E2288D90241E635FB54536643FE765A8D0003D3A3E254C1A4C6607A4253729EF79767C5BD7960C7E6FA47D363FB2834787BB63148E54AB66E899F42DA424AC7C3B2DA1B7D4C70AF20313B16CE856E617641CAC239BE5FD0334103B8
 1411:d=4  hl=4 l= 256 prim:     INTEGER           :36A5916811323CD84FC5E7D2BAE516A3BCAD28D3D79C76D94B904E0CDF5EA35D3623B2513FBF79A6B3399CEEADE3BC7FB6F4DFAF200F57B46B361DABAD682EAD3EACB15BB595960CD06E5DB9798D7BE1D0CD95DC52EDCF87172837DA2C86AEE87B40DF806FB6544288B944E1BC517D2D46B8C3CB06419AA5FCD2446E51C43E012D620D25B789D08D935D829BA7E924ED6C9207325718E9D2DD9176F26D369D1A844F8C8ADE965ABADEBE6985A99EB0AD07E660B8BDD730581240A7CA11CD6AC8E414A07D2A090DEB658F21EFF0288AB3FE143DC3431F2F0ADDAFC0F17B8CAA381E9503C8B945FD803CE7611C76A3CC12826D949634E0269030BF7BA8D89C4E37
 1671:d=4  hl=4 l= 256 prim:     INTEGER           :53F6506C6EEBA0CBEBF5E26D4F93515E5A2303F004F06F50AE0BA2B4B3C5D1E9189AB2A452A0C148098DF612DCE5FD379C07C60E7A2F5F9E770B28B95A41B1182A3D209D4EA8CDCC342A6F9C4AD6E4A6D2032DB19E1C1CB88126062C2221E467A7382D82CC7675376CFDB21DA66F7CD2E0C7FDF33697ACA563B68E8D83AC9871E81B4C5E1E5F7C1E44BB38508B3F1F585622253B55F2FAC765AE945847DFA8570D3B8618707F2BDB9009CB744A2D4921EDBF0AD8547F4385B108B37F9ADB7A00C96790926CCBAD7C34C7390D10B10FA63DA046349B774013FBF38820F9455C53B21BD0EB1366119F6A8E063E154DBA33D9E033B3BBCFE650150C7FBB8ACBFE1D
 1931:d=4  hl=4 l= 257 prim:     INTEGER           :845BAB2E009ABA35462DCFDFFAFA088B9CF73D647301D36823FDEBA14D4F8AD85347D812D91DDF4CCA3E306BF52066E95EE4BA6D67C6AC7984539F22EF99080168C04FD920D39BC42A527474E49695BB80171461052AADA4FE922D8CF21EB8B89C45ABFFFB69018A558C1F8F642603ACD4F028C00075F7AA1CE625A9EF6434DAFEC65D2924DBCCC7CE3721D9D2687E6D89C389DD2888503A139B60ECAF44B7527C168BE439A6DC8F0492B70A4EAAD6305FD463800255634BE8A48ED3D5B0473302AE5B2398AED70468D97A924D5C6B515766A1ACA1187B1DD6D22CB4DDFDFD19D2D8DA72F06B1B7484879F64785F0D8DF8DFE2BBF7BA2D1C9EEB17AF77FCE64C
 2192:d=4  hl=4 l= 256 prim:     INTEGER           :26358D7B5BDC5E77E0BB949A08D00986B14B825B0F9C73FC9822CF6F85C2FD17836E882BD31192B93F5C6870F5B8C880BC5657DD30FB7CCE7D07C5E099E5CA50CC0403F03A7D24FB9A2EDD7A1583086A91D91E50C567129B9FB48FDB4FAD309ADA8BA7C6D690CD1B3CB80B2A30CB85A13EC8E42C301EC2819568DCBFF7672EF1AE3778618017EDC4B70699F3DCF8F823EAD29760FBA6CDF3D51A6369A1DF8D4E4CC0CC28BD775D0BDE47FFE0E5B6ADEC7A0A9BA0671725CE620DF1426B4F420BE96F00BC8F95A766D7A73358701DD1B13AED5A6041E01221041B50252EEA4D4F0C3775B6ABCC68C239F5CE44AE92501DDF3EB074FB7EDE284831AFF4E09D3D49
 2452:d=4  hl=4 l= 256 prim:     INTEGER           :3220EC94B555B1E510819327F28AC54EFF66F2EB4E0D61027B003AA0EAFF8BBCBB773D31320E61CF3CDD9A34677E55B850ACC0275607B4E88D76FD9DE4C42871AF8189118DECF1E6933E343ECF864732A9CBC50BE6C04D2C6C63EC079271BB904960E92F42702BE6EC2CD7BD501364451FDC87D0A03F143DE5871AEE873AFA85169C77B709F21CCE97084CC34D7E91210E9DE7F794AB71270193C79F81D805179941C2790BCAAAD29A81BA81A34E840282D1572B3A5B6C8C8D439492A024D001CF85334F95AA3766212EFA3BE72562F81A95CE1F87F4A052AC9692D669F1F2EC47A400B9D9B68A2DD9D5CF00318DFB63E453C9F0FCA5D47D07D6FBA98F55485C
 2712:d=4  hl=4 l= 256 prim:     INTEGER           :217202E96D4A1BD306B43F10804F3BACA3F729B06A4C5DA36F77D902A1FD8577A128E3DF963E39EDC7D7F103837CF1F1ACE2A9C86A0CEA347326882D0C6E619C8D89900865C7589942D45341151655EA6228D449A02CEBB85B7ADDC523DC721899F9B36ACBC12A5FC610C2F358DE1D5B1BB37038A783FC393B97456368702E3DBF067FDBAEFCB6BE996F00436117C079103953087BFF50BB45DCA2FFC0E56ED47A4A5F1280421426E03C992824797D004439F1BCBCFB58095C948CF632024EF1916D0A7C964115197E3D0E8BBAB70979CE5DFE6822703A18C19F496FEA4FD09E35CE413FEB0FCA74E49CC98F00D026CBE30EE0CE9FB89D52DF58C0BAE7A0AD4D
 2972:d=4  hl=4 l= 256 prim:     INTEGER           :34FD1C2EA16C5C721477D3F3BC53A5EFEF7CE8A79346355F1BFA05FE245074F8166BE2E5BB378030D7A1AA76B2F4E30004FCC5162A54236EC0C0AEB118A97FF9D0933E2D708EBD9735252C8A3215D1965D2CD6BA66941FB65C41E8C1FFE44F94C9EDB7801251220FC69E4D380A427AA5E04F28AE57AA05BAB5DAFE07B030C5B11D78DF723EA46A429EA0D9816C110479DA676A67E52F977B8CDF6FDC345D7476FF00F595554FAFC30A32288E80189FCD0AF6EC46DD1B283CF6CEA2CD60DDB5B2CC8E02F7467B08AB80503AD58E46A4411F921982CBD9C768D4B058BF97979C758B82AFAA7A94CFC27D00BDF0FB00D0040B3FABDC751B9711CB4CD374E52D4215
 3232:d=4  hl=4 l= 256 prim:     INTEGER           :4F8768FCBF0BA68CCA540AB9D187D5E6B65CE4B0D2F59010C8EAAC2D4206D357F807D5692DFCDB49613F72EEDF05AB1ADE3C4345DF52D037DC4B971E3B97F817D402798EE78AE30A4D8F9E31C3F4E2F5769CED2E4E9EAED45D5C33BC8293882376214DCF9E2F10518D04813B8F9BB70D6CD7CC41554F0FF27CB26D62DA8E4B55FCD832B295013563D198E714AE94DD77A35D02DC0BD5D025C81188CF89672B11292730FA3825EFA1D9CF62BA0DD6EEE1FB669FC7AC56AA2E64294A5EAC19AD66B23216B71C49ED6B7FEEF7E845D9B943C922B34A1854BDD8116539B9634D770CE1B3742E689AC11B30CE2734568AD6BCA5F05972C9984B9008B65E1A16629914
 3492:d=4  hl=4 l= 256 prim:     INTEGER           :0EBDEB986B5464781E2955AE6CFBA23539DACB819DE2C41BF7F3586D508891A286515EF60282BBCC699FC45930F017DC4B7578EDB43F76C72280D5F91AA6D7F5985780DD8B9BB54EB5FF255DC3E6566109C482ABF0AD359AC92E31531155C1304424A195105E4503F67BD49EEEBC700B2E52F1995B8A2B7D9633B7241180A400FBDC570AA36B410606613C5C83A97D080F53A75A831096DB80EBEA89A0DA0745FB89D8EA5C72772CB305080B3DAA2048F799D623BD52261A43BB65827BC8D823213B2FC3EA9D1589552E4A9838DDDEE5092D05D458FDAAA8D2E623470324327AE37221CDC068DF9CF2C2F37620E01C056C8F6672DC1B5265E8841BB1A2E56FF9
 3752:d=4  hl=4 l= 256 prim:     INTEGER           :4C7A7E959E4C08AA9BDCA1F55217088C41FB3CFF56432A44E0C1659B534FDBADE63AB24479800270F6AB5A2C827C50137D9861A6391A6CCBC64A2FECDEF8A911D1078B6D42707F9D471BBCFD6DC7D095A6A2BB1A18FE5FE7EB5D7AD56BDA52AD452D04E8D289550272426AC826F4EE608FC3F4AEB953A9AED646B7652CF2385BAC53A3579946DE783B6F0000A246811F1693F34554E48CEF0C6D4FF325514565AD95B00E35EC169ECA50CFB9ECE91CC3939A4DEC97CB93D8F025AA255AFD86655E9495BFBDF007E417D75F7F24A651896E91997D42ACBBC2EE8BE2F61CA0031B5997F4FECAEF54C5EFDD47DDA1A6D7DF42E6FBCA25C13A568E013AA715DE9930
